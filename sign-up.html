<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>杨凌之家-新用户注册</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="assets/css/amazeui.datatables.min.css" />
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/amazeui.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
    <script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/localization/messages_zh.js"></script>
</head>

<body data-type="login">
    <script src="assets/js/theme.js"></script>
    <div class="am-g tpl-g">
        <!-- 风格切换 -->
        <div class="tpl-skiner">
            <div class="tpl-skiner-toggle am-icon-cog">
            </div>
            <div class="tpl-skiner-content">
                <div class="tpl-skiner-content-title">
                    选择主题
                </div>
                <div class="tpl-skiner-content-bar">
                    <span class="skiner-color skiner-white" data-color="theme-white"></span>
                    <span class="skiner-color skiner-black" data-color="theme-black"></span>
                </div>
            </div>
        </div>
        <div class="tpl-login">
            <div class="tpl-login-content">
                <div class="tpl-login-title">注册用户</div>
                <span class="tpl-login-content-info">
                    创建一个新的用户
                </span>
                <form class="am-form tpl-form-line-form" data-am-validator id="formSignup">
                    <div class="am-form-group">
                        <input type="text" class="tpl-form-input" id="userName" minlength="1" placeholder="用户名"
                            required>
                    </div>
                    <div class="am-form-group">
                        <input type="text" class="tpl-form-input" id="userTel" placeholder="电话号码" required isMobile=true />
                    </div>
                    <div class="am-form-group">
                        <input type="password" class="tpl-form-input" id="userPwd" placeholder="请输入密码" required>
                    </div>

                    <div class="am-form-group">
                        <input type="password" class="tpl-form-input" id="userPwdConfirm" placeholder="再次输入密码" required
                            equalTo="#userPwd">
                    </div>

                    <div class="am-form-group tpl-login-remember-me">
                        <input id="remember-me" type="checkbox" name="remember-me" required>
                        <label for="remember-me">
                            我已阅读并同意 <a href="javascript:;">《用户注册协议》</a>
                        </label>
                    </div>
                    <div class="am-form-group">
                        <button type="button" id="Save" onclick="SaveData();return false;" class="am-btn am-btn-primary  am-btn-block tpl-btn-bg-color-success  tpl-login-btn">提交</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
            <div class="am-modal-dialog">
                <div class="am-modal-hd">注册成功</div>
                <div class="am-modal-bd">
                    杨凌之家欢迎你！
                </div>
                <div class="am-modal-footer">
                    <span class="am-modal-btn">确定</span>
                </div>
            </div>
        </div>
        <div class="am-modal am-modal-alert" tabindex="-1" id="my-alertError">
            <div class="am-modal-dialog">
                <div class="am-modal-hd">注册失败</div>
                <div class="am-modal-bd">
                    请重新注册！
                </div>
                <div class="am-modal-footer">
                    <span class="am-modal-btn">确定</span>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {
            // 提交时验证表单
            $("#formSignup").validate({});

            jQuery.validator.addMethod("isMobile", function (value, element) {
                var length = value.length;
                var mobile = /^1(?:3\d|4[4-9]|5[0-35-9]|6[67]|7[013-8]|8\d|9\d)\d{8}$/;
                return this.optional(element) || (length == 11 && mobile.test(value));
            }, "手机号码不符合规范.");
        });

        function SaveData() {
            if ($("#formSignup").valid()) {
                var UserName = $("#userName").val() || '';
                var Mobile = $("#userTel").val() || '';
                var Pwd = $("#userPwd").val() || '';
                var data = { 'UserName': UserName, 'Mobile': Mobile, 'Pwd': Pwd }

                // return $.ajax('YL1.RegFormSignup.json', data).then(function (data) {
                //             if ((data) && (data.d.RetVal == -1)) {
                //                 if (data.d.RetData.Tbl.Rows[0].Success == true) {
                //                     $("#my-alert").modal('open')
                //                 }
                //                 else {
                //                     $("#my-alertError").modal('open')
                //                 }
                //             }
                //         });

                $.ajax({
                    url: "http://web.tool8.cc/JXFC/YL1.RegFormSignup.json",
                    method: "POST",
                    dataType: "json",
                    xhrFields: { withCredentials: true },
                    data: {
                        'data': JSON.stringify(data),
                        'WebPartKey': '3346AC64-D3F4-4452-9B2F-782885588459',
                        'ReqGUID':'A295EA1A-09BA-4FD8-9293-0CE4A136A424'
                    },
                    success: function (data) {
                        alert(1111);
                        if ((data) && (data.d.RetVal === -1)) {
                            if (data.d.RetData.Tbl.Rows.length > 0) {
                                if (data.d.RetData.Tbl.Rows[0].Success == true) {

                                } else { alert(data.d.RetData.Tbl.Rows[0].ReturnMsg); }
                            }
                        }
                        else {
                            alert(data.d.RetMsg);
                        }
                    },
                    error: function (data) {
                        alert("Error: " + data.responseJSON.d.RetMsg);
                    }
                });

            }
        }

    </script>
</body>

</html>