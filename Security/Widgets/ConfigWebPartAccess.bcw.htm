<link rel="stylesheet" href="../styles/jquery.multiselect.css" type="text/css" />
<link rel="stylesheet" href="../styles/jquery.multiselect.filter.css" type="text/css" />
<div id="mainform" class="large-12 columns">
	<div class="row">
		<div class="large-3 columns end">
			<label for="SecretKey">Configuration Key (for making changes)</label><input id="SecretKey" type="text" />
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<button id="BtnRefresh" onclick="refreshData(); return false;">Refresh</button>
			<button id="BtnAdd" onclick="editWP(); return false;">Add WebPart</button>
			<button id="BtnRefreshWPCache" onclick="refreshWPCache(); return false;">Refresh WebPart Cache</button>
			<button id="BtnRefreshALLCache" onclick="refreshALLCache(); return false;">Refresh ALL Cache</button>
			<button id="BtnWakeEventService" onclick="wakeEventService(); return false;">Wake Event Service</button>
		</div>
	</div>
	<div class="row">
		<div class="large-4 columns end">
			<label for="FilterGrid">Filter Grid - All columns</label><input id="FilterGrid" type="text" />
		</div>
	</div>
</div>
<div id="editor" style="display:none">
	<div class="row">
		<div class="large-4 columns">
			<label for="WPID">WebPartID (*.json; *.part; *.appcache)</label><input id="WPID" type="text" />
		</div>
		<div class="large-4 columns">
			<label for="SGAccess">Security Group Access</label>
			<select id="SGAccess" multiple="multiple"></select>
		</div>
		<div class="large-2 columns">
			<label for="Secret">Req. Secret?</label><input type="checkbox" id="Secret">
		</div>
		<div class="large-2 columns">
			<label for="Log">Log Request?</label><input type="checkbox" id="Log">
		</div>
	</div>
	<div class="row">
		<div class="large-4 columns">
			<label for="AllowExtD">Allowed External Domains (| seperated)</label><input id="AllowExtD" type="text" />
		</div>
		<div class="large-4 columns">
			<label for="CacheK">Cache Key (you may use {{Params}}</label><input id="CacheK" type="text" />
		</div>
		<div class="large-2 columns end">
			<label for="CacheS">Cache (Secs)</label><input id="CacheS" type="text" />
		</div>
	</div>

	<div class="row">
		<div class="large-12 columns">
			<label>Type</label>
			<input name="WPType" type="radio" id="radio1" value="URL" onclick="ProcessWPTypeSel();">
			<label for="radio1" class="inline inlineblock">Handler URL</label>
			<input name="WPType" type="radio" id="radio2" value="SQL" onclick="ProcessWPTypeSel();">
			<label for="radio2" class="inline inlineblock">Exec SQL</label>
			<input name="WPType" type="radio" id="radio3" value="XP" onclick="ProcessWPTypeSel();">
			<label for="radio3" class="inline inlineblock">Export XLSX</label>
			<input name="WPType" type="radio" id="radio4" value="SG" onclick="ProcessWPTypeSel();">
			<label for="radio4" class="inline inlineblock">SlickGrid</label>
			<input name="WPType" type="radio" id="radio5" value="SGXP" onclick="ProcessWPTypeSel();">
			<label for="radio5" class="inline inlineblock">Export SlickGrid XLSX</label>
			<input name="WPType" type="radio" id="radio6" value="APPC" onclick="ProcessWPTypeSel();">
			<label for="radio6" class="inline inlineblock">AppCache</label>
			<input name="WPType" type="radio" id="radio7" value="HTMLPart" onclick="ProcessWPTypeSel();">
			<label for="radio7" class="inline inlineblock">HTML Part</label>
		</div>
	</div>
	<div class="row" id="HandlerURLDiv">
		<div class="large-12 columns">
			<label for="HandlerURL">Handler URL</label><textarea id="HandlerURL" rows="3" cols="75"></textarea>
		</div>
	</div>
	<div class="row" id="SGActionDiv">
		<div class="large-6 columns">
			<label for="SGAction">SlickGrid Action</label>
			<select id="SGAction">
				<option value="GetData">Get Grid Data</option>
				<option value="AddRow">Add Row</option>
				<option value="UpdRow">Update Row</option>
				<option value="UpdRowFld">Update Row Field</option>
				<option value="DelRow">Delete Row</option>
				<option value="Custom">Custom</option>
			</select>
		</div>
	</div>
	<div class="row" id="HTMLPartDiv">
		<div class="large-12 columns">
			<label for="HTMLPart">HTML Part</label><textarea id="HTMLPart" rows="10" cols="75"></textarea>
		</div>
	</div>
	<div class="row" id="SQLDiv">
		<div class="large-12 columns">
			<label for="SQL">SQL to Execute</label><textarea id="SQL" rows="4" cols="75"></textarea>
		</div>
	</div>
	<div id="ExportDiv">
		<div class="row">
			<div class="large-3 columns">
				<label for="ExportFilename">Export Filename (.xlsx)</label><input id="ExportFilename" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN1">Sheetname 1</label><input id="ExportSN1" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN2">Sheetname 2</label><input id="ExportSN2" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN3">Sheetname 3</label><input id="ExportSN3" type="text" />
			</div>
		</div>
		<div class="row">
			<div class="large-3 columns">
				<label for="ExportSN4">Sheetname 4</label><input id="ExportSN4" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN5">Sheetname 5</label><input id="ExportSN5" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN6">Sheetname 6</label><input id="ExportSN6" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportSN7">Sheetname 7</label><input id="ExportSN7" type="text" />
			</div>
		</div>
		<div class="row">
			<div class="large-3 columns">
				<label for="ExportReportCategory">Report Category</label>
				<select id="ExportReportCategory">
					<option value="">- No report / remove report if present -</option>
				</select>
			</div>
			<div class="large-6 columns">
				<label for="ExportReportName">Report Title</label><input id="ExportReportName" type="text" />
			</div>
			<div class="large-3 columns">
				<label for="ExportReportDispOrder">Report Display Order</label><input id="ExportReportDispOrder" type="text" />
			</div>
		</div>
		<div class="row">
			<div class="large-12 columns">
				<label for="ExportReportDescription">Report Description</label><input id="ExportReportDescription" type="text" />
			</div>
		</div>
	</div>
	<div class="row" id="SQLAsyncDiv">
		<div class="large-12 columns">
			<label for="SQLAsync">Async Key (Run long queries w Event Service)</label><input id="SQLAsync" type="text" />
		</div>
	</div>
	<div class="row" id="APPCDiv">
		<div class="large-12 columns">
			<label for="APPC">AppCache to Return</label><textarea id="APPC" rows="10" cols="75"></textarea>
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<label for="UsageRemarks">Usage Remarks&nbsp;
				<a href="#" onclick="runJS(); return false;">Run Sample</a>&nbsp;
				<a href="#" onclick="sampleJS(); return false;">Get Sample</a>
			</label><textarea id="UsageRemarks" rows="1" cols="75"></textarea>
		</div>
		<div id="RunResults" class="large-12 columns">
		</div>
	</div>
</div>
<script src="../scripts/jquery.multiselect.min.js"></script>
<script src="../scripts/jquery.multiselect.filter.min.js"></script>
<script>
	//bind to custom togShowHide event
	var $mainform = $('#mainform');
	$(document).ready(function () {
		$("#editor").dialog({
			autoOpen: false, height: 620, width: 850, modal: true,
			buttons: [{ id: "BtnUpsert", text: "Save", click: saveWP },
				{ id: "BtnDel", text: "Delete", click: delWP },
				{ id: "BtnCancel", text: "Cancel", click: function () { $(this).dialog("close"); } }]
		});
		$("#FilterGrid").keyup(function (e) {
			if (e.which == 27) this.value = ''; RefreshGridFilter();
		});
	});
	$(document).on("togShowHide", function (e) {
		if (e.Show) { $mainform.show(); } else { $mainform.hide(); }
	});

	function runJS() {
		$("#RunResults").html("");
		eval($("#UsageRemarks").val());
	}
	function sampleJS() {
		var S = "/*\nYour usage comments here, sample test call below\n*/\n$.JSONPost('" + $("#WPID").val() +  "', { })\n"
		S += ".done(function (data, textStatus, jqXHR) {\n"
		S += "  $('#RunResults').html(JSON.stringify(data));\n"
		S += "});"
		$("#UsageRemarks").val(S);
	}
	function GetCustomGridFilterData() {
		return { FilterGrid: ($("#FilterGrid").val() || '').toLowerCase() };
	}
	function CustomGridFilter(item, args) {
		if ((args.FilterGrid || '') == '') return true;
		for (var property in item) {
			if (item.hasOwnProperty(property)) {
				switch (typeof (item[property])) {
					case 'string':
						if (item[property].toLowerCase().indexOf(args.FilterGrid) != -1) return true;
						break;
					case 'number': case 'boolean':
						if ((('' + item[property]).toLowerCase()).indexOf(args.FilterGrid) != -1) return true;
						break;
				}
			}
		}
		return false;
	}
	function RefreshGridFilter() {
		SGH.DataView.setFilterArgs(GetCustomGridFilterData()); SGH.DataView.refresh();
	}
	function refreshData() { jQuery.event.trigger({ type: "refreshSG" }); }
	function refreshWPCache() { $.JSONPost("Sec1.RefreshWebPartLoookup.json", { "SecretKey": $("#SecretKey").val() }).done(function (data, textStatus, jqXHR) { alert('Refreshed WebPart cache!'); }); }
	function refreshALLCache() { $.JSONPost("Main1.ClearAllCache.json", { "SecretKey": $("#SecretKey").val() }).done(function (data, textStatus, jqXHR) { alert('Cleared all cache!'); }); }
	function wakeEventService() { $.JSONPost("Main1.WakeEventService.json", { "SecretKey": $("#SecretKey").val() }).done(function (data, textStatus, jqXHR) { alert('Event service running now!'); }); }
	function delWP() {
		var E = $("#editor");
		var WebPartID = $("#WPID", E).val() || "";
		var Cfm = prompt("Are you sure you want to delete " + WebPartID + " and its associated permissions? This cannot be undone. To confirm delete, please input 'del' below.");
		if ((Cfm) && (Cfm.toLowerCase() == "del")) {
			$.JSONPost("Sec1.DelWebPart.json", { "SecretKey": $("#SecretKey").val(), "WebPartID": WebPartID })
			.always(function () { refreshData(); })
			.done(function (data, textStatus, jqXHR) {
				E.dialog("close"); data.d.RetMsg = data.d.RetMsg || '';
				if (data.d.RetMsg.length > 0) { alert(data.d.RetMsg); } else { alert('WebPart deleted - remember to Clear WebPart Cache for it to take effect immediately'); }
			});
		}
	}
	function saveWP() {
		var E = $("#editor");
		var WebPartID = $("#WPID", E).val() || "", AllowExtD = $("#AllowExtD", E).val() || "";
		var CacheS = parseInt($("#CacheS", E).val(), 10) || 0, CacheK = $("#CacheK", E).val() || "";
		var UsageRemarks = $("#UsageRemarks", E).val(), SGIDs = ($("#SGAccess", E).val() || [""]).join(",");
		var LogType = (($("#Log", E).prop('checked') || false) ? "1" : "0");
		var ReqSecret = (($("#Secret", E).prop('checked') || false) ? "1" : "0");
		//validate here first!
		if (WebPartID.length == 0) { alert("In order to save, please provide a WebPartID."); return false; }
		var HandlerURL = "", WPType = $("input[name=WPType]:checked").val();
		switch (WPType) {
			case "SQL":
				var AsyncKey = $("#SQLAsync", E).val() || "";
				if (AsyncKey.length > 0) {
					HandlerURL = "/BCMain/JSONDB.ashx?AsyncKey=" + encodeURIComponent(AsyncKey) + "&PartSQL=" + encodeURIComponent($("#SQL", E).val()); break;
				} else {
					HandlerURL = "/BCMain/JSONDB.ashx?PartSQL=" + encodeURIComponent($("#SQL", E).val()); break;
				}
			case "SG":
				HandlerURL = "/BCMain/JSON_SlickGridDataProvider.ashx?Action=" + encodeURIComponent($("#SGAction", E).val()) + "&PartSQL=" + encodeURIComponent($("#SQL", E).val()); break;
			case "XP": case "SGXP":
				if (WPType == 'XP') { HandlerURL = "/ImportExport/ExportXLSX.ashx" } else { HandlerURL = "/BCMain/SlickGridDataExport.ashx" }
				HandlerURL += "?PartSQL=" + encodeURIComponent($("#SQL", E).val());
				var TmpStr = ($("#ExportFilename", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&Filename=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN1", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN1=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN2", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN2=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN3", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN3=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN4", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN4=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN5", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN5=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN6", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN6=" + encodeURIComponent(TmpStr);
				TmpStr = ($("#ExportSN7", E).val() || '');
				if (TmpStr.length > 0) HandlerURL += "&SN7=" + encodeURIComponent(TmpStr);
				break;
			case "APPC":
				HandlerURL = "/BCMain/AppCache.ashx?CVal=" + encodeURIComponent($("#APPC", E).val()); break;
			case "HTMLPart":
				HandlerURL = "/BCMain/HTMLPart.ashx?HTMLPart=" + encodeURIComponent($("#HTMLPart", E).val()); break;
			default:
				HandlerURL = $("#HandlerURL", E).val(); break;
		}
		$.JSONPost("Sec1.UpsertWebPart.json", { "SecretKey": $("#SecretKey").val(), "WebPartID": WebPartID, "HandlerURL": HandlerURL, "ExtDomains": AllowExtD, "ReqSecretKey": ReqSecret, "CacheSecs": CacheS, "CacheKey": CacheK, "LogType": LogType, "UsageRemarks": UsageRemarks })
			.done(function (data, textStatus, jqXHR) {
				data.d.RetMsg = data.d.RetMsg || '';
				if (data.d.RetMsg.length > 0) { alert(data.d.RetMsg); }
				if (WPType == "XP" || WPType == "SGXP") { //update report details (async)
					$.JSONPost("Sec1.UpsertWebPartExportReportDetails.json", { "SecretKey": $("#SecretKey").val(), "WebPartID": WebPartID, "ExportReportCategory": $("#ExportReportCategory").val(), "ExportReportName": $("#ExportReportName").val(), "ExportReportDispOrder": $("#ExportReportDispOrder").val(), "ExportReportDescription": $("#ExportReportDescription").val(), "SecGroupIDs": SGIDs });
				}
				//updated WebPart, now to update sec groups
				$.JSONPost("Sec1.UpsertWebPartPermissions.json", { "SecretKey": $("#SecretKey").val(), "WebPartID": WebPartID, "SecGroupIDs": SGIDs })
				.always(function () { refreshData(); })
				.done(function (data, textStatus, jqXHR) {
					E.dialog("close"); data.d.RetMsg = data.d.RetMsg || '';
					if (data.d.RetMsg.length > 0) { alert(data.d.RetMsg); } else { alert('WebPart added/updated - remember to Clear WebPart Cache for it to take effect immediately'); }
				});
			});
	}
	function editWP(RowID) {
		var E = $("#editor");
		var WebPartID = "", HandlerURL = "", AllowExtD = "", CacheS = "0", CacheK = "", LogType = 0, ReqSecret = 0, UsageRemarks = "";
		if (RowID) {
			var R = SGH.getDataView().getItemById(decodeURIComponent(RowID));
			if (R) {
				WebPartID = R.WebPartID; HandlerURL = R.HandlerURL;
				AllowExtD = R.AllowedExternalDomains; CacheS = R.CacheDurationS;
				CacheK = R.CacheOnParams; LogType = R.LogType; ReqSecret = R.ReqSecret;
				UsageRemarks = R.UsageRemarks;
			}
		}
		$("#RunResults").html("");
		E.dialog("option", "title", (WebPartID.length > 0 ? "Edit " + WebPartID : "Add New WebPart")).dialog("open");
		LoadSecGroups(function () {
			LoadWebPartSec(WebPartID);
			$("#WPID", E).val(WebPartID).prop('readonly', (WebPartID.length > 0));
			$("#AllowExtD", E).val(AllowExtD); $("#CacheS", E).val(CacheS); $("#CacheK", E).val(CacheK);
			$("#UsageRemarks", E).val(UsageRemarks); $("#HTMLPart", E).val("");
			$("#SQL", E).val(""); $("#SQLAsync", E).val(""); $("#SGAction", E).val("");
			$("#ExportFilename", E).val(""); $("#ExportSN1", E).val(""); $("#ExportSN2", E).val("");
			$("#ExportSN3", E).val(""); $("#ExportSN4", E).val(""); $("#ExportSN5", E).val("");
			$("#ExportSN6", E).val(""); $("#ExportSN7", E).val("");
			$("#ExportReportCategory", E).val(""); $("#ExportReportName", E).val("");
			$("#ExportReportDispOrder", E).val(""); $("#ExportReportDescription", E).val("");
			$("#APPC", E).val("CACHE MANIFEST\n# version 1\nCACHE:\n{{AppPath}}/test.htm\nNETWORK:\n*\nFALLBACK:\n/ fallback.htm"); //default sample
			var Log = (LogType != 0); $("#Log", E).prop('checked', Log);
			var rSecret = (ReqSecret != 0); $("#Secret", E).prop('checked', rSecret);
			if (HandlerURL.length > 0) { //process handlerURL
				if ((HandlerURL.indexOf("/Security/JSONDB.ashx") == 0) || (HandlerURL.indexOf("/BCMain/JSONDB.ashx") == 0)) { //sql call
					var QSE = GetQSfrURL(HandlerURL); QSE.PartSQL = QSE.PartSQL || QSE.Action || "";
					$("input[name=WPType][value=SQL]", E).prop('checked', true); $("#SQL", E).val(QSE.PartSQL);
					$("#SQLAsync", E).val(QSE.AsyncKey);
				} else if (HandlerURL.indexOf("/BCMain/JSON_SlickGridDataProvider.ashx") == 0) { //slickgrid
					var QSE = GetQSfrURL(HandlerURL); QSE.PartSQL = QSE.PartSQL || ""; QSE.Action = QSE.Action || "";
					$("input[name=WPType][value=SG]", E).prop('checked', true); $("#SQL", E).val(QSE.PartSQL);
					$("#SGAction", E).val(QSE.Action);
				} else if ((HandlerURL.indexOf("/BCMain/SlickGridDataExport.ashx") == 0) || (HandlerURL.indexOf("/ImportExport/ExportXLSX.ashx") == 0)) { //slickgrid/generic export
					if (HandlerURL.indexOf("/BCMain/SlickGridDataExport.ashx") == 0) { $("input[name=WPType][value=SGXP]", E).prop('checked', true); } else { $("input[name=WPType][value=XP]", E).prop('checked', true); }
					var QSE = GetQSfrURL(HandlerURL); QSE.PartSQL = QSE.PartSQL || ""; QSE.Filename || "";
					QSE.SN1 = QSE.SN1 || ""; QSE.SN2 = QSE.SN2 || ""; QSE.SN3 = QSE.SN3 || ""; QSE.SN4 = QSE.SN4 || "";
					QSE.SN5 = QSE.SN5 || ""; QSE.SN6 = QSE.SN6 || ""; QSE.SN7 = QSE.SN7 || "";
					$("#SQL", E).val(QSE.PartSQL); $("#ExportFilename", E).val(QSE.Filename);
					$("#ExportSN1", E).val(QSE.SN1); $("#ExportSN2", E).val(QSE.SN2);
					$("#ExportSN3", E).val(QSE.SN3); $("#ExportSN4", E).val(QSE.SN4);
					$("#ExportSN5", E).val(QSE.SN5); $("#ExportSN6", E).val(QSE.SN6);
					$("#ExportSN7", E).val(QSE.SN7);
				} else if (HandlerURL.indexOf("/BCMain/AppCache.ashx") == 0) { //appcache
					var QSE = GetQSfrURL(HandlerURL); QSE.CVal = QSE.CVal || "";
					$("input[name=WPType][value=APPC]", E).prop('checked', true);
					if (QSE.CVal.length > 0) { $("#APPC", E).val(QSE.CVal); }
				} else if (HandlerURL.indexOf("/BCMain/HTMLPart.ashx") == 0) { //HTML Part
					var QSE = GetQSfrURL(HandlerURL); QSE.HTMLPart = QSE.HTMLPart || "";
					$("input[name=WPType][value=HTMLPart]", E).prop('checked', true);
					$("#HTMLPart", E).val(QSE.HTMLPart);
				} else { //raw URL
					$("input[name=WPType][value=URL]", E).prop('checked', true); $("#HandlerURL", E).val(HandlerURL);
				}
			} else { //default to raw URL
				$("input[name=WPType][value=URL]", E).prop('checked', true); $("#HandlerURL", E).val("");
			}
			ProcessWPTypeSel();
			if (WebPartID.length > 0) { $("#BtnDel").show(); } else { $("#BtnDel").hide(); }
		});
	}

	function ProcessWPTypeSel() { //show/hide UI
		var E = $("#editor");
		switch ($("input[name=WPType]:checked").val()) {
			case "SQL":
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).show(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).hide(); $("#SQLAsyncDiv", E).show(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).hide(); break;
			case "SG":
				$("#SGActionDiv", E).show(); $("#SQLDiv", E).show(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).hide(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).hide(); break;
			case "SGXP": //Slickgrid Export
				var WebPartID = $("#WPID", E).val();
				LoadWebPartExportReportCategories(function () { LoadWebPartExportReportDetails(WebPartID); });
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).show(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).show(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).hide(); break;
			case "XP": //Export
				var WebPartID = $("#WPID", E).val();
				LoadWebPartExportReportCategories(function () { LoadWebPartExportReportDetails(WebPartID); });
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).show(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).show(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).hide(); break;
			case "APPC": //AppCache
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).hide(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).hide(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).show(); break;
			case "HTMLPart": //HTML Part
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).hide(); $("#HTMLPartDiv", E).show(); $("#ExportDiv", E).hide(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).hide(); $("#APPCDiv", E).hide(); break;
			default:
				$("#SGActionDiv", E).hide(); $("#SQLDiv", E).hide(); $("#HTMLPartDiv", E).hide(); $("#ExportDiv", E).hide(); $("#SQLAsyncDiv", E).hide(); $("#HandlerURLDiv", E).show(); $("#APPCDiv", E).hide(); break;
		}
	}
	function LoadWebPartSec(WebPartID) {
		var $s = $("#SGAccess").val("").multiselect("refresh");
		if ((WebPartID) && (WebPartID.length > 0)) {
			$.JSONPost("Sec1.GetWebPartAccessConfig.json", { "WebPartID": WebPartID })
			.done(function (data) {
				if ((data) && (data.d.RetVal == -1) && (data.d.RetData) && (data.d.RetData.Tbl)) {
					var R = data.d.RetData.Tbl.Rows;
					if ((R) && (R.length > 0)) { $s.val(R[0].SecGroupAccess.split(",")).multiselect("refresh"); }
				}
			});
		}
	}
	function LoadSecGroups(callback) {
		$.JSONPost("Sec1.GetSecGroups.json", "")
			.done(function (data) {
				var R = data.d.RetData.Tbl.Rows;
				var RowCnt = R.length, $sel = $("#SGAccess"); $sel.html('');
				for (var i = 0; i < RowCnt; i++) {
					$sel.append($('<option>', { value: R[i].SecGroupID }).text(R[i].SecGroupName));
				}
				$sel.multiselect({ selectedList: 20 }).multiselectfilter();
				if (callback && typeof (callback) === 'function') { callback(); }
			});
	}
	function LoadWebPartExportReportCategories(callback) {
		$.JSONPost("Sec1.GetWebPartExportReportCategories.json", "")
			.done(function (data) {
				var R = data.d.RetData.Tbl.Rows;
				var RowCnt = R.length, $sel = $("#ExportReportCategory"); $sel.html('');
				$sel.append($('<option>', { value: "" }).text("- No report / remove report if present -"));
				for (var i = 0; i < RowCnt; i++) {
					$sel.append($('<option>', { value: R[i].Category }).text(R[i].CategoryName));
				}
				if (callback && typeof (callback) === 'function') { callback(); }
			});
	}
	function LoadWebPartExportReportDetails(WebPartID, callback) {
		$.JSONPost("Sec1.GetWebPartExportReportDetails.json", { "WebPartID": WebPartID })
			.done(function (data) {
				var RD = data.d.RetData.Tbl.Rows[0];
				$("#ExportReportCategory").val((RD.DisplayCategory || ""));
				$("#ExportReportName").val((RD.ReportName || ""));
				$("#ExportReportDispOrder").val((RD.DispOrder || 1));
				$("#ExportReportDescription").val((RD.Description || ""));
				if (callback && typeof (callback) === 'function') { callback(); }
			});
	}
	function GetQSfrURL(URL) {
		URL = URL || "";
		var iQS = URL.indexOf("?");
		if (iQS >= 0) { //found, first ocurrence is a variable
			return $.deparam(URL.substring(iQS + 1));
		}
		return {};
	}
	window.DoGridInit = true; //ready for SG to init
</script>