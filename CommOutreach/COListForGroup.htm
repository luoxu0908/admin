<!DOCTYPE html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><![endif]-->
<!--[if IE 7]><html class="lt-ie9 lt-ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><![endif]-->
<!--[if IE 8]><html class="lt-ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><![endif]-->
<!--[if gt IE 8]><!--><html xmlns="http://www.w3.org/1999/xhtml"><!--<![endif]-->

<head>
	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Assigned Community List</title>
	<link rel="stylesheet" href="../styles/normalize.css" />
  <link rel="stylesheet" href="../styles/foundation.min.css" />
  <link rel="stylesheet" href="../styles/ie8-grid-foundation-4.css" />
  <link rel="stylesheet" href="../styles/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../styles/slick-default-theme.css" type="text/css"/>
	<link rel="Stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/themes/smoothness/jquery-ui.css" type="text/css" media="all" />
	<!--<link rel="Stylesheet" href="../Styles/Master.css" type="text/css" media="all" />-->
	<link rel="stylesheet" href="../styles/main_new.css">
  <script src="../scripts/vendor/custom.modernizr.js"></script>
</head>
<body>
	<div class="row automarginoff">
		<div class="large-12 columns">
			<form>
				<div class="row">
					<div class="small-2 columns">
						<select id="GroupingCode">
						</select>
						<!--<button id="BtnRefresh" onclick="SGH.GridLoadData({ GroupingCode: $('#GroupingCode').val() }); return false;">Refresh</button>-->
					</div>
					<div class="small-2 columns">
						<select id="GroupPerson">
						</select>
					</div>
					<div class="small-6 columns">
						<button id="BtnAssign" >Assign Worker 1</button>
						<button id="BtnAssign2" >Assign Worker 2</button>
						<button id="BtnAssign3" >Assign Worker 3</button>
					</div>
					<div class="small-2 columns">
						<button id="BtnExport" class = "right" onclick="$.JSONPostNewWindow('CO1.Export_Cell.part',{GroupingCode: $('#GroupingCode').val(), 'Filename': 'CP(Cell) Report'}); return false;">Export</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="row fullwidth">
		<div class="small-12 columns">
			<div id="myGrid" class="GridDimensions"></div>
		</div>
	</div>

	<div id="dialog-confirm" title="Remove worker from selected unit(s)?" class="hide">
		<p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;">
		</span>You have not select any worker yet. Do you want to assign selected unit(s) to be empty?</p>
	</div>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>  	window.jQuery || document.write('<script src="../scripts/jquery.min.js"><\/script>')</script>
  <script src="../scripts/foundation.min.js"></script>
  <!-- get the scripts from google cdn. if unavailable, fallback to the local copy -->
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
  <script>  	window.jQueryUI || document.write('<script src="../scripts/jquery-ui.min.js"><\/script>')</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.0.0/moment.min.js"></script>
	<script src="../scripts/Master.js"></script>
	<script src="../scripts/jquery.event.drag-2.2.min.js"></script>
	<script src="../scripts/slick.bcdefault.js"></script>
	<script src="../scripts/slick.grid.helper.js" charset="utf-8"></script>
	<script type="text/javascript">
		var SGH, resizeTimer; window.Assign = 0;
		$(document).ready(function () {
			var QS = $.parseQS();
			window.GroupID = QS.GroupID;
			window.GridImgFolder = '../styles/images';
			SGH = new SlickGridHelper("#myGrid", "CO.AddressData",
				{ enableCellNavigation: true, enableColumnReorder: true, autoHeight: false, autoEdit: false, editable: true, rowHeight: 30,
					enableAddRow: false, asyncEditorLoading: false, multiColumnSort: true
				},
				{ AddSelColumn: true, GetDataURL: "CO1.AddressData_Get.json", AddRowURL: "", DelRowURL: "",
					UpdRowURL: "", UpdRowFldURL: "", CustomURL: "", ExportURL: "CO1.AddressData_Export.part"
				});
				$("#dialog-confirm").dialog({
					autoOpen: false,
					resizable: false,
					width: 400,
					height: 180,
					modal: true,
					buttons: {
						"Remove worker": function () {
							AssignPerson(window.Assign);
							$(this).dialog("close");
						},
						Cancel: function () {
							$(this).dialog("close");
						}
					}
				});
				$('#BtnAssign,#BtnAssign2,#BtnAssign3').click(function (e) {
					e.preventDefault();
					var id = $(this).attr('id');
					if (id === 'BtnAssign')
						window.Assign = 1;
					else if (id === 'BtnAssign2')
						window.Assign = 2;
					else if (id === 'BtnAssign3')
						window.Assign = 3;
					var $sel = $("#GroupPerson");
					console.log(SGH.getSelectedRowIDsStr());
					if ($sel.val() === '0' && SGH.getSelectedRowIDsStr() !== '')
						$("#dialog-confirm").dialog('open');
					else AssignPerson(window.Assign);
				});
			//Populate selection
			$.JSONPost('CO1.GetAssignedGroupingCodes.json', { GroupID: QS.GroupID }).done(function (data) {
				if ((data) && (data.d.RetVal == -1) && (data.d.RetData) && (data.d.RetData.Tbl)) {
					var R = data.d.RetData.Tbl.Rows;
					var RowCnt = R.length, $sel = $("#GroupingCode");
					for (var i = 0; i < RowCnt; i++) {
						$sel.append($('<option>', { value: R[i].GroupingCode }).text(R[i].GroupingCode));
					}
					SGH.GridLoadData({ GroupingCode: $('#GroupingCode').val() });
					//clearTimeout(resizeTimer); resizeTimer = setTimeout(ResizeMe, 1500);
					ResizeMe();
				}
			});
			$('#GroupingCode').on('change', '', function (event) { SGH.GridLoadData({ GroupingCode: $('#GroupingCode').val() }); }); PopulatePerson();
		});
		function ResizeMe() { SGH.resize(); };
		$(window).resize(function () {
			clearTimeout(resizeTimer); resizeTimer = setTimeout(ResizeMe, 100);
		});
		function PopulatePerson() {
			$.JSONPost('CO1.GetGroupPerson.json', { GroupID: $.parseQS().GroupID }).done(function (data) {
				var R = data.d.RetData.Tbl.Rows;
				var RowCnt = R.length, $sel = $("#GroupPerson"); $sel.html('');
				$sel.append($('<option>', { value: 0 }).text('Please Select Person'));
				for (var i = 0; i < RowCnt; i++) {
					$sel.append($('<option>', { value: R[i].RoleID }).text(R[i].DisplayName));
				}
			});
		}
		function AssignPerson(ColNo) {
			$.JSONPost('CO1.AssignWorker.json', { GroupingCode: $('#GroupingCode').val(), WorkerRoleID: $("#GroupPerson").val(), ColNo: ColNo, SelRows: SGH.getSelectedRowIDsStr() }).done(function (data) {
				if (data.d.RetVal == -1) { //Success
					if (data.d.RetMsg) { alert(data.d.RetMsg); }
					//to unselect all checked boxes
				}
				SGH.GridLoadData({ GroupingCode: $('#GroupingCode').val() });
			});
		}
	</script>
</body>
</html>
