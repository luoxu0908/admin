<div id="filters" class="large-12 columns">
	<div class="row">
		<div class="large-3 columns">
			<label for="VisitID">Visit:</label>
			<select id="VisitID"></select>
		</div>
		<div class="large-3 columns end">
			<label for="VisitResult">Responsiveness:</label>
			<select id="VisitResult"></select>
		</div>
	</div>
</div>
<div id="MTool" class="large-12 columns">
	<button onclick="refreshData(); return false;">Refresh</button>
	<button onclick="exportData(); return false;">Export XLSX</button>
</div>
<script>
	function PopulateResponsiveness(callback) {
		$.JSONPost('CO1.VisitReport_GetResultType.json').done(function (data) {
			var R = data.d.RetData.Tbl.Rows;
			var RowCnt = R.length; $Sel = $("#VisitResult"); $Sel.html('');
			$Sel.append($('<option>', { value: '' }).text('---ALL---'));
			for (var j = 0; j < RowCnt; j++) {
				$Sel.append($('<option>', { value: R[j].LookupKey }).text(R[j].Description));
			}
			if (callback && typeof (callback) === 'function') { callback(); }
		});
	}
	function PopulateVisit(callback) {
		$.JSONPost('CO1.VisitReport_GetVisitID.json').done(function (data) {
			var R = data.d.RetData.Tbl.Rows;
			var RowCnt = R.length; $Sel = $("#VisitID"); $Sel.html('');
			for (var j = 0; j < RowCnt; j++) {
				$Sel.append($('<option>', { value: R[j].VisitID }).text(R[j].ShortDescription));
			}
			if (callback && typeof (callback) === 'function') { callback(); }
		});
	}

	//bind to custom togShowHide event
	var $filters = $('#filters'), $MTool = $('#MTool');
	$(document).on("togShowHide", function (e) {
		if (e.Show) { $filters.show(); $MTool.show(); } else { $filters.hide(); $MTool.hide(); }
	});

	//Init dropdown here
	PopulateVisit(function () {
		PopulateResponsiveness(function () {
			//provide function to return data for filtering (e.g. for slickgrid) only after rest of UI has loaded
			window.GetFilterData = function () {
				var FilterData = { VisitID: $('#VisitID').val(), VisitResult: $('#VisitResult').val() };
				return FilterData;
			}
		});
	})
	
	function refreshData() { jQuery.event.trigger({ type: "refreshSG" }); }
	function exportData() { jQuery.event.trigger({ type: "exportSG" }); }
</script>