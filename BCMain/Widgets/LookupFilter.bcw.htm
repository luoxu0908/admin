<div id="filters" class="large-12 columns">
	<div class="row">
		<div class="large-4 columns end">
			<label for="LookupCat">
				Select Category</label><select id="LookupCat"><option value=""></option>
				</select>
		</div>
	</div>
</div>
<div id="MTool" class="large-12 columns">
	<button onclick="refreshData(); return false;">
		Refresh</button>
	<button onclick="SGH.GridRowDel({ 'RowIDs': SGH.getSelectedRowIDsStr() }); return false;">
		Delete Selected</button>
	<button id="Export" onclick="SGH.GridExport({ LookupCat: $LookupCat.val()}); return false;">
		Export</button>
	<button onclick="AddRow(); return false;">
		Add New</button>
</div>
<div id="DialogAddNew" title="Add New Lookup Entry" style="display: none">
	<div class="row">
		<div class="large-12 columns end">
			<label for="NewLookupCat">
				Category</label><input id="NewLookupCat" type="text" />
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<label for="NewLookupKey">
				Key</label><input id="NewLookupKey" type="text" />
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<label for="NewDescription">
				Text / Description</label><textarea id="NewDescription" rows="4"></textarea>
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<label for="NewDispOrder">
				Integer value / Display order</label><input id="NewDispOrder" type="text" />
		</div>
	</div>
</div>
<script>
	//bind to custom togShowHide event
	var $filters = $('#filters'), $MTool = $('#MTool');
	var $AddNewDlg = $('#DialogAddNew'), $LookupCat = $('#LookupCat'), $NLC = $('#NewLookupCat');
	$(document).on("togShowHide", function (e) {
		if (e.Show) { $filters.show(); $MTool.show(); } else { $filters.hide(); $MTool.hide(); }
	});
	$LookupCat.on("change", function (e) { refreshData() });
	//init
	if (QS.GetLookupCatURL) {
		$.JSONPost(QS.GetLookupCatURL)
		.then(function (data) {
			if ((data) && (data.d.RetVal == -1)) {
				var Tbl = data.d.RetData.Tbl;
				var RowCnt = Tbl.Rows.length;
				if (RowCnt > 0) {
					$.each(Tbl.Rows, function (index, Row) {
						$LookupCat.append($('<option>', { value: Row.LookupCat }).text(Row.LookupCat));
					});
				}
			}
		});
	} else { alert('Developer alert: Please specify the querystring GetLookupCatURL for fetching your lookup category list'); }
	//provide function to return data for filtering (e.g. for slickgrid)
	function GetFilterData() {
		var FilterData = { LookupCat: $LookupCat.val() };
		return FilterData;
	}
	function refreshData() { jQuery.event.trigger({ type: "refreshSG" }); }
	function AddRow() { $AddNewDlg.dialog("open"); }
	$AddNewDlg.dialog({
		autoOpen: false, height: 410, width: 400, modal: true,
		buttons: {
			"Save": function () {
				var Cat = ($NLC.val() || '');
				var Key = ($('#NewLookupKey').val() || '');
				var Desc = ($('#NewDescription').val() || '');
				var DispOrder = ($('#NewDispOrder').val() || '1');
				if (Cat.length > 0) { SGH.GridRowAdd({ "LookupCat": Cat, 'LookupKey': Key, 'Description': Desc, 'DispOrder': DispOrder }); }
				jQuery.event.trigger({ type: "refreshSG" });
				$(this).dialog("close");
			},
			Cancel: function () { $(this).dialog("close"); }
		},
		open: function () { $NLC.val(($LookupCat.val() || '')); },
		close: function () { }
	});
	window.DoGridInit = true; //ready for SG to init
</script>
